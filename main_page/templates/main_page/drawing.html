{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.4.1/lib/p5.min.js"></script>
    <script src="https://unpkg.com/ml5@latest/dist/ml5.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <script src="/static/js/sketch.js"></script>
    <link rel="stylesheet" href="{% static 'css/drawing.css' %}">

    <!-- html2canvas -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="http://html2canvas.hertzen.com/dist/html2canvas.js"></script>

    <style>
        body {
            background-color: #EEE;
        }
    </style>

    <script>
        let word = "";
        function fnRadioName(event) {
            const radioId = event.target.id;
            const query = 'label[for="' + radioId + '"]';
            const text = document.querySelector(query).innerText;
            console.log(text);
            word = text;
        }

        function handOverWord() {
            localStorage.setItem('myword', word);
            window.location.replace('http://127.0.0.1:8000/playing');
            return false;
        }


        // html2canvas를 이용한 canvas 스샷
        function saveImage(){
                html2canvas($('#defaultCanvas0').get(0)).then(function(canvas){
                    var data = canvas.toDataURL();
                    
                    // ajax 통신
                    $.ajax({
                        type: 'POST',
                        url: 'canvasToImage',
                        data: {data:data},
                        success: function(result){
                            var filename = result['filename'];
                        },
                        error: function(e){ alert("에러발생");}
                    });
                });
         
        }


    </script>

</head>

<body>
    <!-- p5로 제작한 sketch js -->
    <h1>🎨자유롭게 그림을 그려주세요!</h1><br>

    <!-- 캔버스 위치 지정 -->
    <div id="sketch-holder"></div><button id="clearBtn" class="btn btn-primary">Clear Canvas</button>
    <div>
        <p><span id="label"></span> (<span id="confidence"></span>%)</p>
    </div>



    <div>
        <div class="nav">
            <a class="nav-logo" href="{% url 'main_page:main' %}">Meta4Music</a>
            {% if id %}
              <li class="nav-login welcome">
                <div class="dropdown">
                  <img id="dropbtn" src="{% static 'img/profile_icon.png' %}" />
                  <div class="dropdown-content">
                    <a href="#">{{id}}님</a>
                    <a onclick="location.href='/account/logout'">로그아웃</a>
                  </div>
                </div>
              </li>
            {% endif %}
          </div>
        <h5>😀 "무엇을 그리셨나요?(동요를 만들기 원하는 단어를 선택해주세요!)"</h5>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="flexRadioDefault" onclick="fnRadioName(event);"
                id="radio1">
            <label class="form-check-label" for="radio1" id="label1">
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="flexRadioDefault" onclick="fnRadioName(event);"
                id="radio2">
            <label class="form-check-label" for="radio2" id="label2">
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="flexRadioDefault" onclick="fnRadioName(event);"
                id="radio3">
            <label class="form-check-label" for="radio3" id="label3">
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="flexRadioDefault" onclick="fnRadioName(event);"
                id="radio4">
            <label class="form-check-label" for="radio4" id="label4">
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="flexRadioDefault" onclick="fnRadioName(event);"
                id="radio5">
            <label class="form-check-label" for="radio5" id="label5">
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="flexRadioDefault" onclick="fnRadioName(event);"
                id="radio6">
            <label class="form-check-label" for="radio6" id="label6">
            </label>
        </div>
    </div>
    <div>
        <button type="button" class="btn btn-secondary" onclick="location.href='/main_page/home'">home으로
            돌아가기⬅</button>
        <a><button type="submit" onclick="return handOverWord();" class="btn btn-warning">Let's Make
                Music</button></a>
        <button type="submit" onclick="return saveImage()" class="btn btn-secondary">저장하기</button>
    </div>

</body>


</html>